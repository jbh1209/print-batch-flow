
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://kgizusgqexmlfcqfjopk.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtnaXp1c2dxZXhtbGZjcWZqb3BrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1NTQwNzAsImV4cCI6MjA2MDEzMDA3MH0.NA2wRme-L8Z15my7n8u-BCQtO4Nw2opfsX0KSLYcs-I";

// Check if we're in Lovable preview mode
const isLovablePreview = 
  typeof window !== 'undefined' && 
  (window.location.hostname.includes('gpteng.co') || window.location.hostname.includes('lovable.dev'));

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    flowType: 'pkce'
  },
  global: {
    // Use HTTP fetch for all operations to avoid WebSocket issues in preview
    fetch: function(url, options) {
      return fetch(url, options);
    }
  },
  realtime: {
    // Disable realtime features in preview mode to prevent WebSocket connection issues
    params: {
      eventsPerSecond: isLovablePreview ? 0 : 10
    }
  }
});

// Create a dedicated client for admin operations and edge function calls
// This client ensures HTTP/REST is used and no WebSocket connections are attempted
export const adminClient = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
    flowType: 'pkce'
  },
  realtime: {
    // Disable realtime connections completely
    params: {
      eventsPerSecond: 0
    }
  },
  global: {
    // Force HTTP/HTTPS fetch for all operations
    fetch: function(url, options) {
      return fetch(url, options);
    }
  }
});
